(()=>{"use strict";const t=class{constructor(t,i,h,s,e){this.row=t,this.col=i,this.width=h,this.height=s,this.color=e,this.offset=50}get left(){return this.col*this.width}get right(){return this.col*this.width+this.width}get top(){return this.row*this.height+this.offset}get bottom(){return this.row*this.height+this.height+this.offset}get rgba(){const t=new RegExp(/\d{1,3}/,"g"),i=Array.from(this.color.matchAll(t));return`rgba(${i[0]}, ${i[1]}, ${i[2]}, .6)`}draw(t){t.beginPath();const i=t.createLinearGradient(this.left,this.top,this.right,this.bottom);i.addColorStop(0,this.color),i.addColorStop(1,this.rgba),t.fillStyle=i,t.strokeStyle="black",t.fillRect(this.left+5,this.top+5,this.width-5,this.height-5),t.strokeRect(this.left+5,this.top+5,this.width-5,this.height-5),t.fill(),t.stroke(),t.closePath()}};let i;i=new class{constructor(t){this.cv=document.getElementById("lienzo"),this.cv.width=405,this.cv.height=600,this.cx=this.cv.getContext("2d"),this.player=new class{constructor(t,i,h){this.x=t,this.y=i,this.width=h,this.height=12}draw(t){t.beginPath(),t.fillStyle="grey",t.strokeStyle="black",t.fillRect(this.x,this.y,this.width,this.height),t.strokeRect(this.x,this.y,this.width,this.height),t.fill(),t.stroke(),t.closePath()}move(t){switch(t){case"ArrowLeft":this.x>10&&(this.x-=10);break;case"ArrowRight":this.x<400-this.width&&(this.x+=10)}}follow(t){this.x=t-this.width/2}}(this.cv.width/2-30,this.cv.height-20,60),this.ball=new class{constructor(t,i,h){this.x=t,this.y=i,this.r=h,this.stop=!0,this.xdir=1,this.ydir=-1}get left(){return this.x-this.r}get right(){return this.x+this.r}get top(){return this.y-this.r}get bottom(){return this.y+this.r}draw(t){t.beginPath(),t.fillStyle="red",t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.fill(),t.closePath()}move(){this.stop||(this.x=this.x+3*this.xdir,this.y=this.y+3*this.ydir)}collide(t,i){this.left<=0||this.right>=t?this.xdir*=-1:(this.top<=50||this.left>=i.x&&this.right<=i.x+i.width&&this.bottom>=i.y)&&(this.ydir*=-1)}intersects(t){const i=this.left<=t.right&&this.right>=t.left,h=this.top<=t.bottom&&this.bottom>=t.top;return i&&(this.bottom>=t.top&&this.top<=t.top||this.top<=t.bottom&&this.bottom>=t.bottom)?1:h&&(this.right>=t.left&&this.left<=t.right||this.left<=t.right&&this.right>=t.left)?2:0}}(this.cv.width/2,this.cv.height-28,7),this.levels=t,this.ActualLevel=1,this.level=t[this.ActualLevel-1],this.blocks=[],this.score=0,this.lifes=3,this.colors=["rgb(255,0,0)","rgb(0,255,255)","rgb(0,0,255)","rgb(128,0,128)","rgb(255,128,0)"]}_draw(){this._clear(),this._drawStatusBar();for(let t of this.blocks)t.draw(this.cx);this.player.draw(this.cx),this.ball.draw(this.cx)}_drawStatusBar(){this.cx.fillStyle="black",this.cx.fillRect(0,0,this.cv.width,50),this.cx.fill(),this.cx.fillStyle="white",this.cx.font="18pt MarkerFelt-Thin, Comic Sans MS",this.cx.fillText("Lifes: ",10,34),this.cx.fillText(`Score: ${this.score}`,160,34),this.cx.fillText(`Level: ${this.ActualLevel}`,300,34),this.cx.fill(),this.cx.fillStyle="red";for(let t=0;t<this.lifes;t++)this.cx.arc(16*t+88,28,6,0,2*Math.PI,!1);this.cx.fill()}_generateLevel(){for(let i=0;i<this.level.length;i++)for(let h=0;h<this.level[i].length;h++)1===this.level[i][h]&&this.blocks.push(new t(i,h,80,30,this.colors[h]))}_clear(){this.cx.beginPath(),this.cx.fillStyle="#ddd",this.cx.strokeStyle="#000",this.cx.fillRect(0,0,this.cv.width,this.cv.height),this.cx.strokeRect(0,0,this.cv.width,this.cv.height),this.cx.fill(),this.cx.stroke(),this.cx.closePath()}_fallBall(){this.lifes--,this.player.x=this.cv.width/2-this.player.width/2,this.ball.x=this.cv.width/2,this.ball.y=this.cv.height-28,this.ball.xdir=1,this.ball.ydir=-1,this.ball.stop=!0}_restart(){this.lifes=3,this.score=0,this._generateLevel()}_nextLevel(){this.player.x=this.cv.width/2-this.player.width/2,this.ball.x=this.cv.width/2,this.ball.y=this.cv.height-28,this.ball.xdir=1,this.ball.ydir=-1,this.ball.stop=!0,this.ActualLevel<this.levels.length&&(this.ActualLevel+=1,this.level=this.levels[this.ActualLevel-1]),this._generateLevel()}_actions(){this.ball.collide(this.cv.width,this.player);for(let t=0;t<this.blocks.length;t++){const i=this.ball.intersects(this.blocks[t]);if(1===i?this.ball.ydir*=-1:2===i&&(this.ball.xdir*=-1),i){this.blocks.splice(t,1),this.score+=10;break}}this.ball.move(),this.player.follow(this.ball.x)}_eventLoop(){this.ball.bottom>=this.cv.height&&this._fallBall(),this.lifes<=0&&this._restart(),0===this.blocks.length&&this._nextLevel()}init(){this._generateLevel()}run(){this._eventLoop(),this._actions(),this._draw()}}([[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],[[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,1,0,1,1],[1,1,0,1,1],[1,1,0,1,1],[1,1,1,1,1]]]),i.init(),console.log(i.ball,i.player),function t(){window.requestAnimationFrame(t),i.run()}(),window.addEventListener("keydown",(t=>{" "!==t.key?i.ball.stop||i.player.move(t.key):i.ball.stop=!1}))})();
